<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Manifest Debug</title>
    <style>
      body {
        font-family: system-ui;
        margin: 20px;
        background: #1a1a1a;
        color: white;
      }
      .log {
        background: #2a2a2a;
        padding: 10px;
        border-radius: 6px;
        margin: 10px 0;
        font-family: monospace;
        white-space: pre-wrap;
        max-height: 400px;
        overflow-y: auto;
      }
      button {
        padding: 12px 24px;
        margin: 10px;
        background: #007acc;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <h1>Manifest Loading Debug</h1>
    <button onclick="testManifestLoad()">Test Manifest Loading</button>
    <div id="log" class="log">Click button to test manifest loading...</div>

    <script type="module">
      const log = document.getElementById("log");

      function addLog(message) {
        const timestamp = new Date().toLocaleTimeString();
        log.textContent += `[${timestamp}] ${message}\n`;
        console.log(message);
        log.scrollTop = log.scrollHeight;
      }

      window.testManifestLoad = async function () {
        addLog("=== Testing Manifest Loading ===");

        try {
          // Import the manifest module
          addLog("Importing manifest module...");
          const { fetchManifest, ManifestError } = await import(
            "./js/manifest.js"
          );
          addLog("✅ Manifest module imported");

          // Test direct fetch first
          addLog("Testing direct fetch of manifest.json...");
          const directResponse = await fetch("/ar/paramo/manifest.json", {
            cache: "no-cache",
          });
          addLog(`Direct fetch status: ${directResponse.status}`);

          if (directResponse.ok) {
            const directData = await directResponse.json();
            addLog("✅ Direct JSON parse successful");
            addLog(`Direct data keys: ${Object.keys(directData).join(", ")}`);
            addLog(`Title: "${directData.title}"`);
            addLog(`Target: "${directData.target}"`);
            addLog(`Overlays count: ${directData.overlays?.length || 0}`);
          } else {
            addLog(`❌ Direct fetch failed: ${directResponse.status}`);
            return;
          }

          // Now test the fetchManifest function
          addLog("Testing fetchManifest function...");
          const manifest = await fetchManifest("paramo");
          addLog("✅ fetchManifest successful!");
          addLog(`Manifest keys: ${Object.keys(manifest).join(", ")}`);
          addLog(`Manifest title: "${manifest.title}"`);
          addLog(`Manifest target: "${manifest.target}"`);
          addLog(`Manifest overlays: ${manifest.overlays?.length || 0}`);
        } catch (error) {
          addLog(`❌ Error: ${error.name} - ${error.message}`);
          if (error.cause) {
            addLog(`Cause: ${error.cause.message}`);
          }
          if (error.stack) {
            addLog(`Stack: ${error.stack}`);
          }
        }
      };

      addLog("Manifest debug tool ready");
    </script>
  </body>
</html>
