<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>AR QR Gallery - Standalone Debug</title>
    <style>
      body {
        margin: 0;
        padding: 20px;
        font-family: Arial, sans-serif;
        background: #f0f0f0;
      }
      #debugLog {
        position: fixed;
        top: 10px;
        right: 10px;
        width: 350px;
        height: 300px;
        background: rgba(0, 0, 0, 0.9);
        color: #00ff00;
        font-family: "Courier New", monospace;
        font-size: 11px;
        padding: 10px;
        overflow-y: auto;
        z-index: 10000;
        border: 2px solid #333;
        border-radius: 5px;
      }
      #arShell {
        width: 100%;
        height: 500px;
        border: 2px solid #333;
        background: #000;
      }
      a-scene {
        width: 100%;
        height: 100%;
      }
      .status {
        text-align: center;
        padding: 20px;
      }
    </style>
  </head>
  <body>
    <div id="debugLog">Starting standalone debug version...<br /></div>

    <h1>AR QR Gallery - Standalone Debug</h1>
    <div class="status" id="status">Initializing...</div>

    <div id="arShell">
      <a-scene
        embedded
        mindar-image="autoStart: true; imageTargetSrc: ./ar/paramo/target.mind;"
        color-space="sRGB"
        renderer="colorManagement: true; physicallyCorrectLights: true"
        vr-mode-ui="enabled: false"
        device-orientation-permission-ui="enabled: false"
        id="mainScene"
      >
        <a-entity mindar-image-target="targetIndex: 0" id="targetRoot">
          <a-box position="0 0 0" color="red" scale="0.1 0.1 0.1"></a-box>
        </a-entity>
        <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>
      </a-scene>
    </div>

    <script src="./libs/aframe.min.js"></script>
    <script src="./libs/mindar-image-aframe.prod.js"></script>
    <script>
      // Debug helper
      const debugLog = document.getElementById("debugLog");
      const status = document.getElementById("status");

      function addDebugLog(message) {
        const timestamp = new Date().toLocaleTimeString();
        debugLog.innerHTML += `[${timestamp}] ${message}<br>`;
        debugLog.scrollTop = debugLog.scrollHeight;
        console.log(`[DEBUG] ${message}`);
        status.textContent = message;
      }

      addDebugLog("Libraries loading...");

      // Check when A-Frame is ready
      window.addEventListener("load", () => {
        addDebugLog("Window loaded");

        if (window.AFRAME) {
          addDebugLog(`A-Frame ready: v${window.AFRAME.version}`);

          // Check MindAR components
          const hasImageSystem = window.AFRAME.systems["mindar-image-system"];
          const hasImageComponent = window.AFRAME.components["mindar-image"];
          const hasTargetComponent =
            window.AFRAME.components["mindar-image-target"];

          addDebugLog(`MindAR system: ${hasImageSystem ? "YES" : "NO"}`);
          addDebugLog(`MindAR component: ${hasImageComponent ? "YES" : "NO"}`);
          addDebugLog(`MindAR target: ${hasTargetComponent ? "YES" : "NO"}`);

          // Get the scene
          const scene = document.getElementById("mainScene");
          if (scene) {
            addDebugLog("Scene element found");

            // Monitor scene events
            scene.addEventListener("loaded", () => {
              addDebugLog("Scene loaded event");
            });

            scene.addEventListener("renderstart", () => {
              addDebugLog("Scene render started");
            });

            scene.addEventListener("arReady", () => {
              addDebugLog("üéâ AR READY! Camera should be working!");
            });

            scene.addEventListener("arError", (e) => {
              addDebugLog(`‚ùå AR ERROR: ${JSON.stringify(e.detail)}`);
            });

            scene.addEventListener("targetFound", () => {
              addDebugLog("üéØ Target found!");
            });

            scene.addEventListener("targetLost", () => {
              addDebugLog("Target lost");
            });

            // Check for video element periodically
            let checkCount = 0;
            const videoCheck = setInterval(() => {
              checkCount++;
              const video = document.querySelector("video");
              const canvas = document.querySelector("canvas");

              if (video) {
                addDebugLog(
                  `üìπ Video found: ${video.videoWidth}x${
                    video.videoHeight
                  }, playing: ${!video.paused}`
                );
                if (video.videoWidth > 0) {
                  clearInterval(videoCheck);
                }
              }

              if (canvas) {
                addDebugLog(
                  `üé® Canvas found: ${canvas.width}x${canvas.height}`
                );
              }

              if (checkCount > 15) {
                addDebugLog("‚è∞ Video check timeout (15s)");
                clearInterval(videoCheck);
              }
            }, 1000);

            // Check system state
            setTimeout(() => {
              if (scene.systems) {
                const mindARSystem = scene.systems["mindar-image-system"];
                if (mindARSystem) {
                  addDebugLog(
                    `MindAR system state: ${JSON.stringify(mindARSystem.data)}`
                  );
                }
              }
            }, 2000);
          } else {
            addDebugLog("‚ùå Scene element NOT found");
          }
        } else {
          addDebugLog("‚ùå A-Frame NOT available");
        }
      });

      // Monitor errors
      window.addEventListener("error", (e) => {
        addDebugLog(`‚ùå JS Error: ${e.message}`);
      });

      addDebugLog("Debug script setup complete");
    </script>
  </body>
</html>
